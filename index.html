HTML<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾·åœ‹ä¸‰äººåˆ†å¸³è¨˜éŒ„å™¨</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.2/package/dist/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 15px; background: #f0f2f5; max-width: 600px; margin: 0 auto; }
        h1 { text-align: center; color: #2c3e50; }
        .input-area { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-bottom: 20px; }
        select, input, button { padding: 12px; margin: 8px 0; font-size: 16px; }
        select, input[type="number"] { width: 100%; border: 1px solid #ddd; border-radius: 8px; }
        button { background: #3498db; color: white; border: none; border-radius: 8px; cursor: pointer; }
        button:active { background: #2980b9; }
        .record { background: #ecf0f1; padding: 10px; margin: 8px 0; border-radius: 8px; }
        .result { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); margin-top: 20px; }
        .big { font-size: 24px; font-weight: bold; color: #2c3e50; }
        .export-btn { background: #27ae60; margin-top: 15px; }
    </style>
</head>
<body>
    <h1>å¾·åœ‹ä¸‰äººåˆ†å¸³è¨˜éŒ„å™¨</h1>
    
    <div class="input-area">
        <select id="person">
            <option value="Dan">Dan</option>
            <option value="Cliff">Cliff</option>
            <option value="Felix">Felix</option>
        </select>
        
        <input type="number" id="amount" placeholder="è¼¸å…¥é‡‘é¡" step="1">
        
        <input type="text" id="note" placeholder="å‚™è¨»ï¼ˆå¯ç•™ç©ºï¼‰">
        
        <button onclick="addRecord()">âœš åŠ å…¥è¨˜éŒ„</button>
    </div>

    <div id="records"></div>

    <div class="result" id="result" style="display:none;">
        <h2>çµç®—çµæœï¼ˆå¹³å‡åˆ†æ”¤ï¼‰</h2>
        <div id="summary"></div>
        <button class="export-btn" onclick="exportExcel()">ğŸ“Š åŒ¯å‡º Excel æª”</button>
    </div>

    <script>
        let records = [];

        function addRecord() {
            const person = document.getElementById("person").value;
            const amount = parseFloat(document.getElementById("amount").value);
            const note = document.getElementById("note").value.trim();

            if (isNaN(amount) || amount <= 0) {
                alert("è«‹è¼¸å…¥æ­£ç¢ºé‡‘é¡ï¼");
                return;
            }

            records.push({ person, amount, note: note || "ç„¡å‚™è¨»" });
            document.getElementById("amount").value = "";
            document.getElementById("note").value = "";
            updateView();
        }

        function updateView() {
            const recordsDiv = document.getElementById("records");
            recordsDiv.innerHTML = "<h3>å·²è¨˜éŒ„é …ç›®ï¼š</h3>";
            
            let totalA = 0, totalB = 0, totalC = 0;
            let html = "";

            records.forEach((r, i) => {
                if (r.person === "Dan") totalA += r.amount;
                if (r.person === "Cliff") totalB += r.amount;
                if (r.person === "Felix") totalC += r.amount;

                html += `<div class="record">
                    ${i+1}. ${r.person} æ”¯ä»˜ <strong>${r.amount}</strong> å…ƒ ï¼ˆ${r.note}ï¼‰
                    <span style="float:right;color:#e74c3c;cursor:pointer;" onclick="deleteRecord(${i})">âœ–</span>
                </div>`;
            });

            recordsDiv.innerHTML += html || "<p>é‚„æ²’æœ‰è¨˜éŒ„ï½</p>";

            // è¨ˆç®—çµæœ
            const total = totalA + totalB + totalC;
            const avg = total / 3;

            const oweA = avg - totalA;
            const oweB = avg - totalB;
            const oweC = avg - totalC;

            const summary = `
                <p>ç¸½é‡‘é¡ï¼š${total.toFixed(0)} å…ƒï¼Œå¹³å‡æ¯äºº ${avg.toFixed(0)} å…ƒ</p>
                <p class="big">${oweA > 0 ? "Dan æ‡‰æ”¶" : "Dan æ‡‰ä»˜"} <strong style="color:${oweA > 0 ? 'green' : 'red'}">${Math.abs(oweA).toFixed(0)}</strong> å…ƒ</p>
                <p class="big">${oweB > 0 ? "Cliff æ‡‰æ”¶" : "Cliff æ‡‰ä»˜"} <strong style="color:${oweB > 0 ? 'green' : 'red'}">${Math.abs(oweB).toFixed(0)}</strong> å…ƒ</p>
                <p class="big">${oweC > 0 ? "Felix æ‡‰æ”¶" : "Felix æ‡‰ä»˜"} <strong style="color:${oweC > 0 ? 'green' : 'red'}">${Math.abs(oweC).toFixed(0)}</strong> å…ƒ</p>
            `;

            document.getElementById("summary").innerHTML = summary;
            document.getElementById("result").style.display = records.length > 0 ? "block" : "none";
        }

        function deleteRecord(index) {
            records.splice(index, 1);
            updateView();
        }

        function exportExcel() {
            const total = records.reduce((sum, r) => sum + r.amount, 0);
            const avg = total / 3;

            const data = [
                ["ä¸‰äººåˆ†å¸³çµç®—è¡¨"],
                [`ç¸½é‡‘é¡ï¼š${total} å…ƒï¼Œæ¯äººå¹³å‡ï¼š${avg.toFixed(0)} å…ƒ`],
                [],
                ["åºè™Ÿ", "ä»˜æ¬¾äºº", "é‡‘é¡", "å‚™è¨»"],
                ...records.map((r, i) => [i+1, r.person, r.amount, r.note]),
                [],
                ["çµç®—çµæœ"],
                ["Dan", avg - records.filter(x=>x.person==="Dan").reduce((s,x)=>s+x.amount,0)],
                ["Cliff", avg - records.filter(x=>x.person==="Cliff").reduce((s,x)=>s+x.amount,0)],
                ["Felix", avg - records.filter(x=>x.person==="Felix").reduce((s,x)=>s+x.amount,0)],
            ];

            const ws = XLSX.utils.aoa_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "åˆ†å¸³çµæœ");
            XLSX.writeFile(wb, `ä¸‰äººåˆ†å¸³_${new Date().toISOString().slice(0,10)}.xlsx`);
        }

        // è®“ Enter éµä¹Ÿèƒ½åŠ å…¥
        document.addEventListener("keypress", e => {
            if (e.key === "Enter") addRecord();
        });
    </script>
</body>

</html>
